"use strict";(self.webpackChunkrimbu_docs=self.webpackChunkrimbu_docs||[]).push([[86833],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=i,f=p["".concat(s,".").concat(m)]||p[m]||d[m]||r;return n?o.createElement(f,a(a({ref:t},u),{},{components:n})):o.createElement(f,a({ref:t},u))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:i,a[1]=l;for(var c=2;c<r;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},90889:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>y,contentTitle:()=>b,default:()=>x,frontMatter:()=>f,metadata:()=>h,toc:()=>v});var o=n(3905),i=Object.defineProperty,r=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,p=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&u(e,n,t[n]);if(l)for(var n of l(t))c.call(t,n)&&u(e,n,t[n]);return e},d=(e,t)=>r(e,a(t)),m=(e,t)=>{var n={};for(var o in e)s.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&l)for(var o of l(e))t.indexOf(o)<0&&c.call(e,o)&&(n[o]=e[o]);return n};const f={id:"advanced-concepts",slug:"./in-depth",title:"Collections in-depth"},b=void 0,h={unversionedId:"advanced/advanced-concepts",id:"advanced/advanced-concepts",title:"Collections in-depth",description:"Collection Context",source:"@site/docs/advanced/advanced-concepts.mdx",sourceDirName:"advanced",slug:"/advanced/in-depth",permalink:"/docs/advanced/in-depth",draft:!1,editUrl:"https://github.com/rimbu-org/rimbu/edit/master/website/docs/advanced/advanced-concepts.mdx",tags:[],version:"current",frontMatter:{id:"advanced-concepts",slug:"./in-depth",title:"Collections in-depth"},sidebar:"sidebar",previous:{title:"Tuple",permalink:"/docs/deep/tuple"},next:{title:"List Advanced topics",permalink:"/docs/advanced/list"}},y={},v=[{value:"Collection Context",id:"collection-context",level:2},{value:"The default context",id:"the-default-context",level:3},{value:"Custom context",id:"custom-context",level:3},{value:"Context references",id:"context-references",level:3},{value:"The singleton empty instance",id:"the-singleton-empty-instance",level:3},{value:"Builders in-depth",id:"builders-in-depth",level:2},{value:"No iterators",id:"no-iterators",level:3}],g={toc:v},k="wrapper";function x(e){var t=e,{components:n}=t,i=m(t,["components"]);return(0,o.kt)(k,d(p(p({},g),i),{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",p({},{id:"collection-context"}),"Collection Context"),(0,o.kt)("p",null,"To understand how immutable collections in Rimbu for TypeScript are stuctured, it is needed to understand the concept of Contexts. A Context in Rimbu is an object that can create instances and builders of a certain collection. It usually contains some configuration that is uses to create collection instances. For example, for block-based data structures, it might contain a specific block-size."),(0,o.kt)("h3",p({},{id:"the-default-context"}),"The default context"),(0,o.kt)("p",null,"All non-abstract collection types have default constructors that use the ",(0,o.kt)("inlineCode",{parentName:"p"},"defaultContext")," to construct instances."),(0,o.kt)("pre",null,(0,o.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"import { List } from '@rimbu/core';\n\nList.of(1, 2, 3);\n// is equivalent to:\nList.defaultContext().of(1, 2, 3);\n")),(0,o.kt)("h3",p({},{id:"custom-context"}),"Custom context"),(0,o.kt)("p",null,"All Rimbu collections are configurable. To create a custom configured collection, there is the ",(0,o.kt)("inlineCode",{parentName:"p"},".createContext()")," method, e.g. for Lists:"),(0,o.kt)("pre",null,(0,o.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"import { List } from '@rimbu/core';\n\n// create a context to create Lists with block sizes of maximum size 2^7 = 128 elements\nconst MyList = List.createContext({ blockSizeBits: 7 });\n\n// we can now use MyList to construct custom instances.\nconst list = MyList.of(1, 2, 3);\n")),(0,o.kt)("h3",p({},{id:"context-references"}),"Context references"),(0,o.kt)("p",null,"Every collection or builder instance that a Context creates will have a reference to that Context. In this way, the configuration can be preserved."),(0,o.kt)("pre",null,(0,o.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"import { List } from '@rimbu/core';\n\nconsole.log(List.of(1, 2, 3).context === List.defaultContext());\n// => true\n\nconst MyList = List.createContext({ blockSizeBits: 3 });\nconsole.log(MyList.of(1, 2, 3).context === List.of(1, 2, 3).context);\n// => false\n")),(0,o.kt)("h3",p({},{id:"the-singleton-empty-instance"}),"The singleton empty instance"),(0,o.kt)("p",null,"Every Context has a singleton empty value, which is the only empty collection that the specific Context will ever produce. The singleton is context specific because it needs a reference to the context that created it to maintain its configuration."),(0,o.kt)("pre",null,(0,o.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"import { List } from '@rimbu/core';\n\nconsole.log(List.empty<number>() === List.empty<string>());\n// => true\n\nconst MyList = List.createContext({ blockSizeBits: 3 });\nconsole.log(MyList.empty() === List.empty());\n// => false\n")),(0,o.kt)("admonition",p({},{type:"note"}),(0,o.kt)("p",{parentName:"admonition"},"At first it may seem strange that a context can use the same object to represent empty collections of all types. From a philosophical perspective however, it can be compared as follows:"),(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("em",{parentName:"p"},"If I gave you an empty basket of apples, or an empty basket of oranges, would you see the difference?"))),(0,o.kt)("h2",p({},{id:"builders-in-depth"}),"Builders in-depth"),(0,o.kt)("p",null,"All immutable collections have a corresponding mutable Builder. The builder can be used when many mutations need to happen at one time, or when the immutable methods do not have enough expression power to perform the mutation. Rimbu tries to keep the conversion to and from a builder as efficient as possible."),(0,o.kt)("pre",null,(0,o.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"import { List } from '@rimbu/core';\n\nconst list = List.of(1, 2, 3);\n\nconst builder = list.toBuilder();\n\nconsole.log(builder.get(1));\n// => 2\n\nbuilder.append(4);\nconst list2 = builder.build();\n\nbuilder.append(5);\nconst list3 = builder.build();\n")),(0,o.kt)("p",null,"In this example, until the first ",(0,o.kt)("inlineCode",{parentName:"p"},"append")," function, the builder did not copy any data, but referenced the source immutable List. For a large List, the builder would only copy and update the last block. When re-building the immutable list, it can then still share many blocks with the original list, saving time and memory."),(0,o.kt)("p",null,"The example also shows that a builder build intermediate instances as well, so it is safe to re-use the same builder."),(0,o.kt)("admonition",p({},{type:"note"}),(0,o.kt)("p",{parentName:"admonition"},"The Rimbu Builder API's are generally not as expressive as the immutable ones, since this is not the focus of the library. It is purely aimed at building immutable instances and not as a replacement for a mutable collection library.")),(0,o.kt)("h3",p({},{id:"no-iterators"}),"No iterators"),(0,o.kt)("p",null,"Rimbu Builders are not iterable. Iterating over a mutable object is inherently unsafe, since in the iteration it is possible to mutate the object, causing all kinds of nasty side-effects."),(0,o.kt)("p",null,"The only way to perform logic on all the elements in a builder, is to use the ",(0,o.kt)("inlineCode",{parentName:"p"},".forEach(...)")," methods. When performing a ",(0,o.kt)("inlineCode",{parentName:"p"},"forEach")," on a builder, performing any mutation on the builder will throw a runtime error. This is to protect against unpredictable behaviors."))}x.isMDXComponent=!0}}]);